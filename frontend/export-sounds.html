<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Effects Exporter</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; background: #1a1a2e; color: #eee; }
        h1 { color: #ff9500; }
        .sound-btn { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 15px; margin: 10px 0; background: #16213e; border: 2px solid #0f3460; border-radius: 8px; color: #eee; font-size: 16px; cursor: pointer; text-align: left; }
        .sound-btn:hover { background: #0f3460; }
        .sound-btn.playing { background: #4ecdc4; border-color: #4ecdc4; }
        .export-btn { padding: 5px 10px; background: #ff6b6b; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .actions { display: flex; gap: 10px; margin-top: 30px; }
        .actions button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        .play-all { background: #4ecdc4; color: #1a1a2e; }
        .export-all { background: #ff6b6b; color: #fff; }
        #status { margin-top: 20px; padding: 10px; background: #0f3460; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>ðŸ”Š Sound Effects Exporter</h1>
    <p>Click ðŸ”Š to preview, click ðŸ“¥ to export individual, or use Export All below.</p>

    <div id="buttons"></div>
    <div id="status"></div>

    <div class="actions">
        <button class="play-all" onclick="playAll()">â–¶ Play All</button>
        <button class="export-all" onclick="exportAll()">ðŸ“¥ Export All (WAV)</button>
    </div>

    <script>
        let audioCtx = null;
        function getAudioCtx() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return audioCtx; }

        // Sound generators - EXACT match to game code
        const sounds = [
            {
                id: 'coin',
                name: 'Coin (regular)',
                duration: 0.15,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(660, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.08);
                    gain.gain.setValueAtTime(0.2, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.1);
                }
            },
            {
                id: 'golden-coin',
                name: 'Golden Coin (50pts)',
                duration: 0.55,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1760, ctx.currentTime + 0.1);
                    osc.frequency.exponentialRampToValueAtTime(2640, ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.3, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.5);
                }
            },
            {
                id: 'powerup-magnet',
                name: 'Power-up: Magnet',
                duration: 0.45,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(120, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(240, ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.2, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.4);
                }
            },
            {
                id: 'powerup-speed',
                name: 'Power-up: Speed',
                duration: 0.3,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(440, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.15);
                    gain.gain.setValueAtTime(0.15, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.25);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.25);
                }
            },
            {
                id: 'powerup-freeze',
                name: 'Power-up: Freeze',
                duration: 0.55,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(1000, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.4);
                    gain.gain.setValueAtTime(0.15, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.5);
                }
            },
            {
                id: 'round-start',
                name: 'Round Start (GO!)',
                duration: 0.55,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(440, ctx.currentTime);
                    osc.frequency.setValueAtTime(660, ctx.currentTime + 0.15);
                    osc.frequency.setValueAtTime(880, ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.12, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.5);
                }
            },
            {
                id: 'round-end',
                name: 'Round End (Time\'s Up)',
                duration: 0.55,
                render: (ctx, dest) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(dest);
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(660, ctx.currentTime);
                    osc.frequency.setValueAtTime(440, ctx.currentTime + 0.2);
                    osc.frequency.setValueAtTime(330, ctx.currentTime + 0.4);
                    gain.gain.setValueAtTime(0.12, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 0.5);
                }
            }
        ];

        // Create buttons
        sounds.forEach(sound => {
            const btn = document.createElement('button');
            btn.className = 'sound-btn';
            btn.innerHTML = `<span>ðŸ”Š ${sound.name}</span><button class="export-btn" onclick="event.stopPropagation(); exportOne('${sound.id}')">ðŸ“¥</button>`;
            btn.onclick = () => {
                btn.classList.add('playing');
                const ctx = getAudioCtx();
                ctx.resume().then(() => {
                    sound.render(ctx, ctx.destination);
                    setTimeout(() => btn.classList.remove('playing'), 300);
                });
            };
            document.getElementById('buttons').appendChild(btn);
        });

        function playAll() {
            const ctx = getAudioCtx();
            ctx.resume();
            sounds.forEach(s => s.render(ctx, ctx.destination));
        }

        // WAV encoder
        function bufferToWav(abuffer) {
            const numChannels = abuffer.numberOfChannels;
            const sampleRate = abuffer.sampleRate;
            const bitDepth = 16;
            const result = abuffer.getChannelData(0);
            const dataLength = result.length * (bitDepth / 8);
            const buffer = new ArrayBuffer(44 + dataLength);
            const view = new DataView(buffer);

            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
            };

            writeString(0, 'RIFF');
            view.setUint32(4, 36 + dataLength, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numChannels * (bitDepth / 8), true);
            view.setUint16(32, numChannels * (bitDepth / 8), true);
            view.setUint16(34, bitDepth, true);
            writeString(36, 'data');
            view.setUint32(40, dataLength, true);

            let offset = 44;
            for (let i = 0; i < result.length; i++, offset += 2) {
                const s = Math.max(-1, Math.min(1, result[i]));
                view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function exportOne(id) {
            const sound = sounds.find(s => s.id === id);
            if (!sound) return;

            const sampleRate = 48000;
            const offlineCtx = new OfflineAudioContext(1, sampleRate * sound.duration, sampleRate);
            sound.render(offlineCtx, offlineCtx.destination);
            const renderedBuffer = await offlineCtx.startRendering();
            const wav = bufferToWav(renderedBuffer);
            downloadBlob(wav, `${sound.id}.wav`);
        }

        async function exportAll() {
            const status = document.getElementById('status');
            status.textContent = 'Exporting...';
            for (const sound of sounds) {
                status.textContent = `Exporting: ${sound.name}...`;
                await exportOne(sound.id);
                await new Promise(r => setTimeout(r, 100));
            }
            status.textContent = 'âœ… All sounds exported!';
            setTimeout(() => status.textContent = '', 2000);
        }
    </script>
</body>
</html>
